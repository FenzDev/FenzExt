<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<PropertyGroup>
	  <AssetsConfigTargetPath>$(ReferencingProjectRoot)/AssetsConfig.json</AssetsConfigTargetPath>
	  <BuildingToolDir>$(MSBuildThisFileDirectory)../Fenzwork.BuildingTools/bin/$(Configuration)/net8.0</BuildingToolDir>
	  <BuildingToolPath>$(BuildingToolDir)/Fenzwork.BuildingTools.dll</BuildingToolPath>
	  <MGCBAutoGeneratedDirPath>$(BaseIntermediateOutputPath)Content/</MGCBAutoGeneratedDirPath>
	  <MGCBAutoGeneratedFilePath>$(MGCBAutoGeneratedDirPath)Content.mgcb</MGCBAutoGeneratedFilePath>
	</PropertyGroup>
	
	<PropertyGroup Condition="'$(Configuration)'=='Debug'">
		<AssetsSourceFullPath>$(ReferencingProjectRoot)/$(AssetsSourcePath)</AssetsSourceFullPath>
	</PropertyGroup>

	<PropertyGroup Condition="'$(AssetsSourcePath)'==''">
		<AssetsSourcePath>Content</AssetsSourcePath>
	</PropertyGroup>

	<Target Name="EnsureJsonFileCopied" BeforeTargets="BeforeBuild">
		<PropertyGroup>
			<AssetsConfigTemplatePath>$(MSBuildThisFileDirectory)AssetsConfig.json</AssetsConfigTemplatePath>	
        </PropertyGroup>
      <Copy
        Condition="!Exists('$(AssetsConfigTargetPath)')"
        SourceFiles="$(AssetsConfigTemplatePath)"
        DestinationFiles="$(AssetsConfigTargetPath)" />
	</Target>

	<ItemGroup>
		<FinalAssetDir Include="$(AssetsSourceFullPath)" />
		<FinalConfigFile Include="$(AssetsConfigTargetPath)" />
		<MonoGameContentReference Include="$(MGCBAutoGeneratedFilePath)" />
	</ItemGroup>

	<Target Name="RunBuildingTool" BeforeTargets="BeforeBuild">
	  <Exec 
			  WorkingDirectory="$(ReferencingProjectRoot)"
			  Command="dotnet &quot;$(BuildingToolPath)&quot; &quot;@(FinalConfigFile->'%(FullPath)')&quot; &quot;@(FinalAssetDir->'%(FullPath)')&quot; &quot;@(MonoGameContentReference->'%(FullPath)')&quot;" />
      
	</Target>
	
	<Target Name="CopyAssets" AfterTargets="Build">
		<Copy   SourceFolders="$(MGCBAutoGeneratedDirPath)bin/$(AssetsSourcePath)"
				DestinationFolder="$(OutputPath)"
				SkipUnchangedFiles="True"/>
    </Target>

	<Target Name="CleanAssets" BeforeTargets="Clean">
		<RemoveDir Directories="$(OutputPath)$(AssetsSourcePath)"
				ContinueOnError="WarnAndContinue"/>
		<RemoveDir Directories="$(MGCBAutoGeneratedDirPath)"
				ContinueOnError="WarnAndContinue"/>
    </Target>

</Project>
